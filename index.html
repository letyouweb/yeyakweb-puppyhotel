<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PuppyHotel - 프리미엄 반려동물 호텔 &amp; 미용 서비스</title>
    <meta name="description" content="안전하고 전문적인 반려동물 호텔, 미용, 데이케어 서비스를 제공합니다. 24시간 전문 관리로 소중한 반려동물을 돌봅니다." />
    <meta name="keywords" content="반려동물 호텔, 펫호텔, 강아지 미용, 반려동물 데이케어, 펫샵" />
    <link rel="canonical" href="https://puppyhotel.com" />
    <meta name="last-modified" content="2025-01-27" />

    <!-- Social Media Tags -->
    <meta property="og:title" content="PuppyHotel - 프리미엄 반려동물 호텔 &amp; 미용 서비스" />
    <meta property="og:description" content="안전하고 전문적인 반려동물 호텔, 미용, 데이케어 서비스를 제공합니다." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://puppyhotel.com" />

    <!-- Geo Tags -->
    <meta name="geo.region" content="KR-41" />
    <meta name="geo.placename" content="성남시" />
    <meta name="geo.position" content="37.3947;127.1056" />

    <!-- Remix Icon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

    <style>
      /* Customize Readdy floating button to use branded chatbot icon */
      #vapi-widget-floating-button {
        width: 64px !important;
        height: 64px !important;
        border-radius: 50% !important;
        background-color: transparent !important;
        background-image: url('/yeyakweb_chatbot.png');
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        border: none !important;
        box-shadow: 0 10px 25px rgba(20, 184, 166, 0.35);
      }

      #vapi-widget-floating-button svg,
      #vapi-widget-floating-button img {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <!--
      Readdy Agent Widget disabled
      원래 이 위치에 챗봇 위젯을 로드하는 스크립트가 있었습니다.
      서비스에서 챗봇을 더 이상 사용하지 않으므로 해당 스크립트를 제거하여
      홈페이지에서 챗봇이 보이지 않도록 합니다.
    -->

    <!-- 강화된 AI 챗봇 예약 처리 시스템 -->
    <script>
      // 전역 예약 관리 시스템
      window.PuppyHotelReservationSystem = {
        // 예약 데이터 저장
        saveReservation: function (reservationData) {
          try {
            console.log('예약 저장 시작:', reservationData);

            // 예약 ID 생성 (중복 방지)
            const reservationId =
              'chatbot_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

            // 예약 데이터 정규화
            const normalizedReservation = {
              id: reservationId,
              petName: reservationData.petName || '반려동물',
              ownerName: reservationData.ownerName || '고객',
              service: reservationData.service || 'grooming',
              date: reservationData.date || new Date().toISOString().split('T')[0],
              time: reservationData.time || '미정',
              status: 'pending', // 항상 대기 상태로 시작
              phone: reservationData.phone || '연락처 미제공',
              roomType: reservationData.roomType || null,
              checkIn: reservationData.checkIn || reservationData.date,
              checkOut: reservationData.checkOut || null,
              style: reservationData.style || null,
              source: 'chatbot',
              createdAt: new Date().toISOString(),
            };

            // 전체 예약 목록에 추가
            const allReservations = JSON.parse(localStorage.getItem('allReservations') || '[]');
            allReservations.push(normalizedReservation);
            localStorage.setItem('allReservations', JSON.stringify(allReservations));

            // 서비스별 예약 목록에 추가
            const serviceKey =
              normalizedReservation.service === 'hotel'
                ? 'hotelReservations'
                : normalizedReservation.service === 'grooming'
                ? 'groomingReservations'
                : 'daycareReservations';
            const serviceReservations = JSON.parse(localStorage.getItem(serviceKey) || '[]');
            serviceReservations.push(normalizedReservation);
            localStorage.setItem(serviceKey, JSON.stringify(serviceReservations));

            // 실시간 업데이트 이벤트 발생
            this.notifyReservationUpdate(normalizedReservation);

            console.log('예약 저장 완료:', normalizedReservation);
            return normalizedReservation;
          } catch (error) {
            console.error('예약 저장 중 오류:', error);
            return null;
          }
        },

        // 실시간 업데이트 알림
        notifyReservationUpdate: function (reservation) {
          // 커스텀 이벤트 발생
          window.dispatchEvent(
            new CustomEvent('reservationUpdated', {
              detail: {
                type: 'new_reservation',
                reservation: reservation,
              },
            }),
          );

          // 관리자 대시보드가 열려있다면 즉시 업데이트
          if (window.location.pathname.includes('/admin/dashboard')) {
            setTimeout(() => {
              window.location.reload();
            }, 1000);
          }

          // 성공 알림
          this.showNotification('예약이 접수되었습니다! 관리자가 확인 후 연락드리겠습니다.');
        },

        // 알림 표시
        showNotification: function (message) {
          // 기존 알림 제거
          const existingNotification = document.getElementById('reservation-notification');
          if (existingNotification) {
            existingNotification.remove();
          }

          // 새 알림 생성
          const notification = document.createElement('div');
          notification.id = 'reservation-notification';
          notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10B981;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            max-width: 300px;
            animation: slideIn 0.3s ease-out;
          `;
          notification.innerHTML = `
            <div style="display: flex; align-items: center;">
              <i class="ri-check-circle-line" style="margin-right: 8px; font-size: 18px;"></i>
              <span>${message}</span>
            </div>
          `;

          // 애니메이션 스타일 추가
          if (!document.getElementById('notification-styles')) {
            const style = document.createElement('style');
            style.id = 'notification-styles';
            style.textContent = `
              @keyframes slideIn {
                from {
                  transform: translateX(100%);
                  opacity: 0;
                }
                to {
                  transform: translateX(0);
                  opacity: 1;
                }
              }
            `;
            document.head.appendChild(style);
          }

          document.body.appendChild(notification);

          // 5초 후 자동 제거
          setTimeout(() => {
            if (notification.parentNode) {
              notification.style.animation = 'slideIn 0.3s ease-out reverse';
              setTimeout(() => notification.remove(), 300);
            }
          }, 5000);
        },

        // 테스트 예약 생성
        createTestReservation: function () {
          const testData = {
            petName: '테스트강아지',
            ownerName: '테스트고객',
            service: 'grooming',
            date: new Date().toISOString().split('T')[0],
            time: '14:00',
            phone: '010-1234-5678',
            style: '전체미용',
          };

          const result = this.saveReservation(testData);
          if (result) {
            alert('테스트 예약이 생성되었습니다! 관리자 대시보드에서 확인해보세요.');
          } else {
            alert('테스트 예약 생성에 실패했습니다.');
          }
        },
      };

      // AI 챗봇 상담 컨텍스트 설정
      window.puppyHotelContext = {
        businessInfo: {
          name: 'PuppyHotel',
          services: ['반려동물 호텔', '미용 서비스', '데이케어'],
          location: '경기도 성남시 분당구 판교로 123',
          phone: '031-123-4567',
          hours: '평일 09:00-20:00, 주말 09:00-18:00',
          email: 'info@puppyhotel.com',
        },
        pricing: {
          hotel: {
            small: '30,000원/1박 (7kg 이하)',
            medium: '40,000원/1박 (7-15kg)',
            large: '50,000원/1박 (15kg 이상)',
            cat: '35,000원/1박',
          },
          grooming: {
            small: '40,000원 (기본)',
            medium: '60,000원 (기본)',
            large: '80,000원 (기본)',
            special: '100,000원~ (푸들, 비숑 등)',
          },
        },
      };

      // 챗봇 예약 처리 함수 (하위 호환성)
      window.handleChatbotReservation = function (reservationData) {
        return window.PuppyHotelReservationSystem.saveReservation(reservationData);
      };

      // 테스트 함수 (하위 호환성)
      window.testChatbotReservation = function () {
        window.PuppyHotelReservationSystem.createTestReservation();
      };

      // Readdy Agent 이벤트 리스너 설정
      document.addEventListener('DOMContentLoaded', function () {
        console.log('PuppyHotel 예약 시스템 초기화 완료');

        // 위젯 로드 대기 후 이벤트 설정
        setTimeout(function () {
          // 메시지 이벤트 리스너
          window.addEventListener('message', function (event) {
            try {
              // Readdy Agent에서 오는 예약 완료 메시지 처리
              if (event.data && event.data.type === 'reservation_completed') {
                console.log('챗봇 예약 완료 이벤트 수신:', event.data);
                window.PuppyHotelReservationSystem.saveReservation(event.data.reservation);
              }

              // 챗봇 대화에서 예약 키워드 감지
              if (event.data && typeof event.data === 'string') {
                const message = event.data.toLowerCase();
                if (message.includes('예약') && (message.includes('완료') || message.includes('확인'))) {
                  console.log('예약 관련 대화 감지됨');
                  // 예약 정보 추출 및 저장 로직 (필요시 구현)
                }
              }
            } catch (error) {
              console.error('메시지 이벤트 처리 중 오류:', error);
            }
          });

          // 챗봇 위젯 클릭 이벤트 감지
          const chatbotButton = document.querySelector('#vapi-widget-floating-button');
          if (chatbotButton) {
            console.log('챗봇 버튼 감지됨');
            chatbotButton.addEventListener('click', function () {
              console.log('챗봇 상담 시작');
            });
          }
        }, 3000);
      });

      // 페이지 언로드 시 예약 데이터 백업
      window.addEventListener('beforeunload', function () {
        const allReservations = localStorage.getItem('allReservations');
        if (allReservations) {
          console.log('예약 데이터 백업 완료');
        }
      });

      // 개발자 도구용 디버깅 함수
      window.debugReservations = function () {
        console.log('=== 예약 데이터 디버깅 ===');
        console.log('전체 예약:', JSON.parse(localStorage.getItem('allReservations') || '[]'));
        console.log('미용 예약:', JSON.parse(localStorage.getItem('groomingReservations') || '[]'));
        console.log('호텔 예약:', JSON.parse(localStorage.getItem('hotelReservations') || '[]'));
        console.log('데이케어 예약:', JSON.parse(localStorage.getItem('daycareReservations') || '[]'));
      };

      // 예약 데이터 초기화 함수 (테스트용)
      window.clearAllReservations = function () {
        if (confirm('모든 예약 데이터를 삭제하시겠습니까?')) {
          localStorage.removeItem('allReservations');
          localStorage.removeItem('groomingReservations');
          localStorage.removeItem('hotelReservations');
          localStorage.removeItem('daycareReservations');
          alert('모든 예약 데이터가 삭제되었습니다.');
          window.location.reload();
        }
      };
    </script>
  </body>
</html>