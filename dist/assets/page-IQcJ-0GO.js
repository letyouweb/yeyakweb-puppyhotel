import{r as n,u as O,j as t}from"./index-CXV8rOrb.js";import{r as $,a as D}from"./supabase-DzxmIhwm.js";import{c as z,d as B}from"./adminReservationActions-BcfFZl9V.js";import{c as F,s as K}from"./dashboardHelper-CryY47LK.js";const C=["hotel","grooming","daycare"],S=s=>[...s].sort((a,i)=>{const c=C.indexOf(a.service)-C.indexOf(i.service);if(c!==0)return c;const u=a.time||"99:99",d=i.time||"99:99";return u.localeCompare(d)}),_=()=>{const s=new Date,a=s.getTime()+s.getTimezoneOffset()*60*1e3;return new Date(a+540*60*1e3).toISOString().split("T")[0]};function H(s=!0){const a=n.useMemo(()=>_(),[]),[i,c]=n.useState([]),[u,d]=n.useState(!0),[g,x]=n.useState(!1),[r,p]=n.useState(null),j=n.useCallback(l=>l.filter(o=>o.date===a&&o.status!=="cancelled"&&o.status!=="deleted"),[a]),b=n.useCallback(async()=>{if(s){x(!0),p(null);try{const l=await $.getByDate(a),o=j(l.map(F));c(S(o))}catch(l){console.error("Failed to load today reservations:",l),p("오늘 예약을 불러오지 못했습니다. 잠시 후 다시 시도해주세요.")}finally{d(!1),x(!1)}}},[s,j,a]),N=n.useCallback(l=>{c(o=>{if(l.type==="DELETE"&&l.id)return o.filter(f=>f.id!==l.id);const m=l.data;if(!m)return o;if(m.date!==a||m.status==="cancelled"||m.status==="deleted")return o.filter(f=>f.id!==m.id);const k=o.find(f=>f.id===m.id)?o.map(f=>f.id===m.id?m:f):[...o,m];return S(k)})},[a]);n.useEffect(()=>{if(!s){d(!1);return}let l=null;return b(),l=K(N),()=>{l?.unsubscribe?.()}},[s,b,N]);const w=n.useMemo(()=>({grooming:S(i.filter(l=>l.service==="grooming")),hotel:S(i.filter(l=>l.service==="hotel")),daycare:S(i.filter(l=>l.service==="daycare"))}),[i]);return{todayGrooming:w.grooming,todayHotel:w.hotel,todayDaycare:w.daycare,refresh:b,isLoading:u,isRefreshing:g,error:r,todayKey:a}}const E={grooming:"미용",hotel:"호텔",daycare:"데이케어"},R=[{key:"grooming",title:"1. 오늘 미용 예약"},{key:"hotel",title:"2. 오늘 호텔 예약"},{key:"daycare",title:"3. 오늘 데이케어 예약"}],P={pending:"대기",confirmed:"확정",completed:"완료",cancelled:"취소",deleted:"삭제됨"},U={pending:"bg-amber-50 text-amber-700 border-amber-200",confirmed:"bg-emerald-50 text-emerald-700 border-emerald-200",completed:"bg-slate-100 text-slate-600 border-slate-200",cancelled:"bg-rose-50 text-rose-700 border-rose-200",deleted:"bg-rose-50 text-rose-700 border-rose-200"},I=s=>{if(!s)return"";const a=new Date(`${s}T00:00:00`);if(Number.isNaN(a.getTime()))return s;try{const c=new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",weekday:"short"}).formatToParts(a),u=c.find(r=>r.type==="year")?.value??"",d=c.find(r=>r.type==="month")?.value??"",g=c.find(r=>r.type==="day")?.value??"",x=c.find(r=>r.type==="weekday")?.value??"";return`${u}-${d}-${g} (${x})`}catch{return s}},V=s=>s.checkIn||s.checkOut?`${s.checkIn||"-"} ~ ${s.checkOut||"-"}`:s.time||null,G=s=>{const a=I(s.date),i=V(s);return[a,i].filter(Boolean).join(" ")},Y=s=>s.service==="grooming"?s.style||"미용 예약":s.service==="hotel"?s.roomType||"호텔 예약":s.service==="daycare"?s.roomType||"데이케어 예약":E[s.service];function Z(){const s=O(),[a,i]=n.useState(!1),[c,u]=n.useState(null),[d,g]=n.useState(null),{todayGrooming:x,todayHotel:r,todayDaycare:p,refresh:j,isLoading:b,isRefreshing:N,error:w,todayKey:l}=H(a),o=I(l);n.useEffect(()=>{let e=!0;return(async()=>{try{const h=await D.getSession();if(!e)return;if(!h?.user){s("/admin");return}localStorage.setItem("adminAuth","true"),i(!0)}catch(h){console.error("Failed to initialize mobile dashboard:",h),e&&u("관리자 인증에 실패했습니다. 다시 로그인해주세요.")}})(),()=>{e=!1}},[s]);const m=n.useMemo(()=>({grooming:x.length,hotel:r.length,daycare:p.length,total:x.length+r.length+p.length}),[p.length,x.length,r.length]),T=n.useMemo(()=>[{...R[0],reservations:x},{...R[1],reservations:r},{...R[2],reservations:p}],[p,x,r]),k=c||w,f=()=>{N||j()},L=async()=>{try{await D.logout()}catch(e){console.error("Failed to logout:",e)}finally{localStorage.removeItem("adminAuth"),s("/admin")}},v=async(e,y)=>{g(e),u(null),(await z(e,y)).success?await j():u("상태를 업데이트하지 못했습니다. 다시 시도해주세요."),g(null)},A=async e=>{if(!(typeof window>"u"?!0:window.confirm("이 예약을 삭제할까요?")))return;g(e),u(null),(await B(e)).success?await j():u("예약을 삭제하지 못했습니다. 잠시 후 다시 시도해주세요."),g(null)},M=e=>{const y=G(e),h=Y(e);return t.jsxs("article",{className:"mb-2 flex flex-col gap-1 rounded-xl border border-slate-200 bg-white p-3 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsx("span",{className:"text-base font-semibold text-slate-900",children:e.petName||e.ownerName||"예약"}),t.jsx("span",{className:`text-xs font-semibold rounded-full border px-2 py-1 ${U[e.status]}`,children:P[e.status]})]}),t.jsx("div",{className:"text-xs text-gray-600",children:[y,h].filter(Boolean).join("  ")||"일정 정보 없음"}),e.phone?t.jsx("p",{className:"text-xs text-slate-500",children:e.phone}):null,e.specialNotes?t.jsx("p",{className:"rounded-lg bg-slate-50 px-3 py-2 text-sm text-slate-600",children:e.specialNotes}):null,t.jsxs("div",{className:"mt-1 flex justify-end gap-2",children:[e.status==="pending"?t.jsxs("button",{type:"button",onClick:()=>v(e.id,"confirmed"),disabled:d===e.id,className:"inline-flex items-center gap-1 rounded-full bg-emerald-500 px-3 py-1 text-xs font-semibold text-white disabled:opacity-50",children:[t.jsx("i",{className:"ri-check-line text-sm"}),d===e.id?"처리 중...":"확정"]}):null,(e.status==="pending"||e.status==="confirmed")&&t.jsxs("button",{type:"button",onClick:()=>v(e.id,"cancelled"),disabled:d===e.id,className:"inline-flex items-center gap-1 rounded-full border border-amber-200 bg-amber-50 px-3 py-1 text-xs font-semibold text-amber-700 disabled:opacity-50",children:[t.jsx("i",{className:"ri-close-line text-sm"}),d===e.id?"처리 중...":"취소"]}),t.jsxs("button",{type:"button",onClick:()=>A(e.id),disabled:d===e.id,className:"inline-flex items-center gap-1 rounded-full border border-slate-300 px-3 py-1 text-xs font-semibold text-slate-700 disabled:opacity-50",children:[t.jsx("i",{className:"ri-delete-bin-line text-sm"}),d===e.id?"처리 중...":"삭제"]})]})]},e.id)};return t.jsx("main",{className:"min-h-screen bg-slate-50 px-4 py-4",children:t.jsxs("div",{className:"mx-auto flex w-full max-w-xl flex-col gap-4",children:[t.jsxs("header",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"PuppyHotel"}),t.jsx("h1",{className:"text-2xl font-semibold text-slate-900",children:"모바일 관리자"})]}),t.jsx("button",{type:"button",onClick:()=>s("/admin/dashboard"),className:"rounded-full border border-slate-300 px-4 py-1 text-sm font-medium text-slate-700",children:"데스크톱 버전 보기"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-slate-500",children:"오늘"}),t.jsx("p",{className:"text-lg font-semibold text-slate-900",children:o})]}),t.jsx("button",{type:"button",onClick:L,className:"text-sm font-medium text-rose-500 underline-offset-2 hover:underline",children:"로그아웃"})]})]}),k?t.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-4 py-3 text-sm text-rose-700",children:k}):null,t.jsxs("section",{className:"rounded-3xl border border-slate-100 bg-white px-5 py-4 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-slate-500",children:"오늘 예약"}),t.jsx("p",{className:"text-3xl font-semibold text-slate-900",children:m.total})]}),t.jsx("button",{type:"button",onClick:f,disabled:N,className:"rounded-full bg-slate-900 px-4 py-2 text-sm font-medium text-white disabled:opacity-50",children:N?"불러오는 중...":"새로고침"})]}),t.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2 text-center text-sm",children:["hotel","grooming","daycare"].map(e=>t.jsxs("div",{className:"rounded-2xl bg-slate-50 px-2 py-3",children:[t.jsx("p",{className:"text-xs text-slate-500",children:E[e]}),t.jsx("p",{className:"text-xl font-semibold text-slate-900",children:m[e]})]},e))})]}),t.jsx("div",{className:"flex flex-col gap-6",children:T.map(e=>{const y=!b&&e.reservations.length===0;return t.jsxs("section",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:e.title}),t.jsxs("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-700",children:[e.reservations.length,"건"]})]}),b?t.jsx("div",{className:"rounded-3xl border border-slate-100 bg-white px-5 py-8 text-center text-slate-500",children:"불러오는 중입니다..."}):null,y?t.jsxs("div",{className:"rounded-3xl border border-dashed border-slate-200 bg-white px-5 py-8 text-center text-slate-500",children:["오늘은 ",E[e.key]," 예약이 없습니다."]}):null,!b&&e.reservations.map(h=>M(h))]},e.key)})})]})})}export{Z as default};
//# sourceMappingURL=page-IQcJ-0GO.js.map
