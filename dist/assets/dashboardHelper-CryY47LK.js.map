{"version":3,"file":"dashboardHelper-CryY47LK.js","sources":["../../src/components/feature/RealtimeReservationSync.tsx","../../src/lib/realSMS.ts","../../src/lib/dashboardHelper.ts"],"sourcesContent":["import { useEffect } from 'react';\r\n\r\n// Ïã§ÏãúÍ∞Ñ ÏòàÏïΩ ÎèôÍ∏∞ÌôîÎ•º ÏúÑÌïú Ïú†Ìã∏Î¶¨Ìã∞ Ïª¥Ìè¨ÎÑåÌä∏\r\n// Î∏åÎùºÏö∞Ï†ÄÏùò localStorageÏóê Ï†ÑÏ≤¥ ÏòàÏïΩÍ≥º ÏÑúÎπÑÏä§Î≥Ñ ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌïòÍ≥†,\r\n// Ïä§ÌÜ†Î¶¨ÏßÄ Î≥ÄÍ≤ΩÏùÑ Í∞êÏßÄÌïòÏó¨ Îã§Î•∏ Ïª¥Ìè¨ÎÑåÌä∏Ïóê ÏóÖÎç∞Ïù¥Ìä∏ Ïù¥Î≤§Ìä∏Î•º Ï†ÑÎã¨Ìï©ÎãàÎã§.\r\nexport default function RealtimeReservationSync() {\r\n  useEffect(() => {\r\n    // Ï¥àÍ∏∞Ìôî: Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê ÌïÑÏöîÌïú ÌÇ§Í∞Ä ÏóÜÏúºÎ©¥ Îπà Î∞∞Ïó¥Î°ú ÏÉùÏÑ±\r\n    const initializeReservationData = () => {\r\n      if (!localStorage.getItem('allReservations')) {\r\n        localStorage.setItem('allReservations', JSON.stringify([]));\r\n      }\r\n      if (!localStorage.getItem('hotelReservations')) {\r\n        localStorage.setItem('hotelReservations', JSON.stringify([]));\r\n      }\r\n      if (!localStorage.getItem('groomingReservations')) {\r\n        localStorage.setItem('groomingReservations', JSON.stringify([]));\r\n      }\r\n      // ÏÉàÎ°úÏö¥ Îç∞Ïù¥ÏºÄÏñ¥ ÏòàÏïΩ Ï†ÄÏû•ÏÜå Ï¥àÍ∏∞Ìôî\r\n      if (!localStorage.getItem('daycareReservations')) {\r\n        localStorage.setItem('daycareReservations', JSON.stringify([]));\r\n      }\r\n    };\r\n\r\n    initializeReservationData();\r\n\r\n    // Îã§Î•∏ ÌÉ≠ÏóêÏÑú localStorageÍ∞Ä Î≥ÄÍ≤ΩÎê† Îïå Î≥ÄÍ≤ΩÏùÑ Í∞êÏßÄÌïòÏó¨ Ïª§Ïä§ÌÖÄ Ïù¥Î≤§Ìä∏Î•º Î∞úÏÉù\r\n    const handleStorageChange = (e: StorageEvent) => {\r\n      if (\r\n        e.key === 'allReservations' ||\r\n        e.key === 'hotelReservations' ||\r\n        e.key === 'groomingReservations' ||\r\n        e.key === 'daycareReservations'\r\n      ) {\r\n        window.dispatchEvent(new CustomEvent('reservationUpdated'));\r\n      }\r\n    };\r\n\r\n    window.addEventListener('storage', handleStorageChange);\r\n    return () => {\r\n      window.removeEventListener('storage', handleStorageChange);\r\n    };\r\n  }, []);\r\n  return null; // UIÎ•º Î†åÎçîÎßÅÌïòÏßÄ ÏïäÎäî Ïú†Ìã∏Î¶¨Ìã∞ Ïª¥Ìè¨ÎÑåÌä∏\r\n}\r\n\r\n// ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞Î•º localStorageÏóê ÏóÖÎç∞Ïù¥Ìä∏ÌïòÎäî Ïú†Ìã∏Î¶¨Ìã∞ Ìï®Ïàò\r\n// Ï†ÑÏ≤¥ ÏòàÏïΩ(allReservations)Í≥º ÏÑúÎπÑÏä§Î≥Ñ ÏòàÏïΩ(hotel/grooming/daycare) Î∞∞Ïó¥Ïóê ÏÉà ÏòàÏïΩÏùÑ Ï∂îÍ∞Ä/ÏóÖÎç∞Ïù¥Ìä∏Ìïú ÌõÑ\r\n// reservationUpdated Ïù¥Î≤§Ìä∏Î•º Î∞úÏÉùÏãúÏºú Îã¨Î†• Ïª¥Ìè¨ÎÑåÌä∏Í∞Ä ÏÉà Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÎèÑÎ°ù Ìï©ÎãàÎã§.\r\n// Ï§ëÎ≥µ Î∞©ÏßÄ: ÎèôÏùºÌïú IDÍ∞Ä ÏûàÏúºÎ©¥ Í∏∞Ï°¥ ÏòàÏïΩÏùÑ ÏóÖÎç∞Ïù¥Ìä∏ÌïòÍ≥†, ÏóÜÏúºÎ©¥ Ï∂îÍ∞ÄÌï©ÎãàÎã§.\r\nexport const updateReservationData = (\r\n  newReservation: any,\r\n  type: 'hotel' | 'grooming' | 'daycare'\r\n) => {\r\n  // Ï†ÑÏ≤¥ ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏\r\n  const allReservations = JSON.parse(localStorage.getItem('allReservations') || '[]');\r\n  const allIndex = allReservations.findIndex((r: any) => r.id === newReservation.id);\r\n  if (allIndex !== -1) {\r\n    // Í∏∞Ï°¥ ÏòàÏïΩ ÏóÖÎç∞Ïù¥Ìä∏\r\n    allReservations[allIndex] = newReservation;\r\n  } else {\r\n    // ÏÉà ÏòàÏïΩ Ï∂îÍ∞Ä\r\n    allReservations.push(newReservation);\r\n  }\r\n  localStorage.setItem('allReservations', JSON.stringify(allReservations));\r\n\r\n  // ÏÑúÎπÑÏä§Î≥Ñ ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏\r\n  let serviceKey: string;\r\n  switch (type) {\r\n    case 'hotel':\r\n      serviceKey = 'hotelReservations';\r\n      break;\r\n    case 'grooming':\r\n      serviceKey = 'groomingReservations';\r\n      break;\r\n    case 'daycare':\r\n      serviceKey = 'daycareReservations';\r\n      break;\r\n    default:\r\n      serviceKey = 'groomingReservations';\r\n  }\r\n  const serviceReservations = JSON.parse(localStorage.getItem(serviceKey) || '[]');\r\n  const serviceIndex = serviceReservations.findIndex((r: any) => r.id === newReservation.id);\r\n  if (serviceIndex !== -1) {\r\n    // Í∏∞Ï°¥ ÏòàÏïΩ ÏóÖÎç∞Ïù¥Ìä∏\r\n    serviceReservations[serviceIndex] = newReservation;\r\n  } else {\r\n    // ÏÉà ÏòàÏïΩ Ï∂îÍ∞Ä\r\n    serviceReservations.push(newReservation);\r\n  }\r\n  localStorage.setItem(serviceKey, JSON.stringify(serviceReservations));\r\n\r\n  // Îã§Î•∏ Ïª¥Ìè¨ÎÑåÌä∏ÏóêÍ≤å Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤ΩÏùÑ ÏïåÎ¶º\r\n  window.dispatchEvent(new CustomEvent('reservationUpdated'));\r\n  \r\n  // ÏΩòÏÜî Î°úÍ∑∏Î°ú ÎîîÎ≤ÑÍπÖ Ï†ïÎ≥¥ Ï∂úÎ†•\r\n  console.log(`‚úÖ ÏòàÏïΩ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å: ${type} - ${newReservation.petName} (${newReservation.id})`);\r\n};\r\n\r\n// ÏÑ†ÌÉùÎêú ÏòàÏïΩÏùÑ localStorageÏóêÏÑú Ï†úÍ±∞ÌïòÎäî Ìï®Ïàò\r\n// Ï£ºÏñ¥ÏßÑ ID Î∞∞Ïó¥Ïóê Ìï¥ÎãπÌïòÎäî ÏòàÏïΩÏùÑ Ï†ÑÏ≤¥ ÏòàÏïΩÍ≥º Í∞Å ÏÑúÎπÑÏä§Î≥Ñ ÏòàÏïΩ Î™©Î°ùÏóêÏÑú ÏÇ≠Ï†úÌïòÍ≥†\r\n// reservationUpdated Ïù¥Î≤§Ìä∏Î•º Î∞úÏÉùÏãúÏºú Îã¨Î†• Îç∞Ïù¥ÌÑ∞Î•º Í∞±Ïã†Ìï©ÎãàÎã§.\r\nexport const removeReservationData = (ids: string[]) => {\r\n  if (!ids?.length) return;\r\n  // Ï†ÑÏ≤¥ ÏòàÏïΩ Î∞∞Ïó¥ÏóêÏÑú Ï†úÍ±∞\r\n  const allReservations = JSON.parse(localStorage.getItem('allReservations') || '[]');\r\n  const filteredAll = allReservations.filter((r: any) => !ids.includes(r.id));\r\n  localStorage.setItem('allReservations', JSON.stringify(filteredAll));\r\n\r\n  // ÏÑúÎπÑÏä§Î≥Ñ Î∞∞Ïó¥ÏóêÏÑú Ï†úÍ±∞\r\n  const keys = ['hotelReservations', 'groomingReservations', 'daycareReservations'];\r\n  keys.forEach((key) => {\r\n    const list = JSON.parse(localStorage.getItem(key) || '[]');\r\n    const filtered = list.filter((r: any) => !ids.includes(r.id));\r\n    localStorage.setItem(key, JSON.stringify(filtered));\r\n  });\r\n\r\n  // Î≥ÄÍ≤Ω ÏïåÎ¶º\r\n  window.dispatchEvent(new CustomEvent('reservationUpdated'));\r\n};\r\n\r\n// ÏòàÏïΩ ÌÜµÍ≥ÑÎ•º Î∞òÌôòÌïòÎäî Ïú†Ìã∏Î¶¨Ìã∞ Ìï®Ïàò\r\nexport const getReservationStats = () => {\r\n  const allReservations = JSON.parse(localStorage.getItem('allReservations') || '[]');\r\n  const today = new Date().toISOString().split('T')[0];\r\n  return {\r\n    total: allReservations.length,\r\n    today: allReservations.filter((r: any) => (r.date || r.checkIn) === today).length,\r\n    hotel: allReservations.filter((r: any) => r.service === 'hotel').length,\r\n    grooming: allReservations.filter((r: any) => r.service === 'grooming').length,\r\n    daycare: allReservations.filter((r: any) => r.service === 'daycare').length,\r\n    pending: allReservations.filter((r: any) => r.status === 'pending').length,\r\n    confirmed: allReservations.filter((r: any) => r.status === 'confirmed').length,\r\n    completed: allReservations.filter((r: any) => r.status === 'completed').length\r\n  };\r\n};","// realSMS.ts - ÏôÑÏ†Ñ ÏàòÏ†ï Î≤ÑÏ†Ñ (Î™®Îì† Î¨∏Ï†ú Ìï¥Í≤∞)\n\nimport type { Reservation } from './supabase';\n\nconst isDev = (import.meta.env?.DEV ?? import.meta.env?.MODE === 'development') === true;\nconst DEFAULT_ENDPOINT = isDev\n  ? 'http://localhost:3000/api/sms/confirm'\n  : '/api/sms/confirm';\n\nconst hasCustomEndpoint =\n  !!import.meta.env?.VITE_SMS_ENDPOINT && import.meta.env.VITE_SMS_ENDPOINT.length > 0;\nconst forceCustomEndpoint =\n  (import.meta.env?.VITE_SMS_FORCE_ENDPOINT ?? '').toString().toLowerCase() === 'true';\n\nconst shouldUseCustomEndpoint = hasCustomEndpoint && (!isDev || forceCustomEndpoint);\n\nconst windowOrigin = typeof window !== 'undefined' ? window.location.origin : '';\nconst sameOriginEndpoint = windowOrigin ? `${windowOrigin}${DEFAULT_ENDPOINT}` : DEFAULT_ENDPOINT;\n\nconst API_URL = shouldUseCustomEndpoint\n  ? import.meta.env.VITE_SMS_ENDPOINT!\n  : isDev && windowOrigin.includes('localhost')\n  ? DEFAULT_ENDPOINT\n  : sameOriginEndpoint;\n\n// ‚úÖ SMS ÏóêÎü¨ ÌÅ¥ÎûòÏä§\nclass SMSError extends Error {\n  constructor(\n    public code: string,\n    public statusCode?: number,\n    message?: string\n  ) {\n    super(message || `SMS Error: ${code}`);\n    this.name = 'SMSError';\n  }\n}\n\n// ‚úÖ Ïû¨ÏãúÎèÑ Î°úÏßÅ\nasync function sleep(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\ninterface FetchOptions extends RequestInit {\n  retries?: number;\n  timeout?: number;\n}\n\nasync function fetchWithRetry(\n  url: string,\n  options: FetchOptions = {}\n): Promise<Response> {\n  const {\n    retries = 3,\n    timeout = 15000,\n    ...fetchOptions\n  } = options;\n\n  let lastError: Error | null = null;\n\n  for (let attempt = 1; attempt <= retries; attempt++) {\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n      const response = await fetch(url, {\n        ...fetchOptions,\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      // ‚úÖ ÏÑ±Í≥µ ÏùëÎãµ\n      if (response.ok) {\n        return response;\n      }\n\n      // ‚úÖ Ïû¨ÏãúÎèÑ Í∞ÄÎä•Ìïú ÏóêÎü¨ (5xx, 429)\n      if (response.status >= 500 || response.status === 429) {\n        if (attempt < retries) {\n          const delay = 1000 * attempt;\n          console.warn(\n            `‚ö†Ô∏è  Ïû¨ÏãúÎèÑ ${attempt}/${retries} (${delay}ms ÌõÑ): HTTP ${response.status}`\n          );\n          await sleep(delay);\n          continue;\n        }\n      }\n\n      // ‚úÖ Ïû¨ÏãúÎèÑ Î∂àÍ∞ÄÎä•Ìïú ÏóêÎü¨ (4xx)\n      throw new SMSError(\n        'HTTP_ERROR',\n        response.status,\n        `HTTP ${response.status}: ${response.statusText}`\n      );\n    } catch (error) {\n      lastError = error as Error;\n\n      if (error instanceof SMSError) {\n        throw error;\n      }\n\n      if (error instanceof TypeError && error.message.includes('fetch')) {\n        if (attempt < retries) {\n          const delay = 1000 * attempt;\n          console.warn(\n            `‚ö†Ô∏è  Ïû¨ÏãúÎèÑ ${attempt}/${retries} (${delay}ms ÌõÑ): ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò`\n          );\n          await sleep(delay);\n          continue;\n        }\n      }\n\n      throw new SMSError(\n        'NETWORK_ERROR',\n        undefined,\n        `ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${lastError.message}`\n      );\n    }\n  }\n\n  throw lastError || new SMSError('UNKNOWN_ERROR', undefined, 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò');\n}\n\n// ‚úÖ ÏïàÏ†ÑÌïú JSON ÌååÏã±\nasync function parseResponse<T>(response: Response): Promise<T> {\n  const contentType = response.headers.get('content-type');\n  const text = await response.text();\n\n  // ‚úÖ Îπà ÏùëÎãµ Ï≤¥ÌÅ¨\n  if (!text) {\n    throw new SMSError(\n      'EMPTY_RESPONSE',\n      response.status,\n      'API ÏùëÎãµÏù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§'\n    );\n  }\n\n  // ‚úÖ JSON ÌòïÏãù Ï≤¥ÌÅ¨\n  if (!contentType?.includes('application/json')) {\n    throw new SMSError(\n      'INVALID_CONTENT_TYPE',\n      response.status,\n      `ÏòàÏÉÅÏπò Î™ªÌïú Content-Type: ${contentType}`\n    );\n  }\n\n  try {\n    return JSON.parse(text) as T;\n  } catch (error) {\n    throw new SMSError(\n      'JSON_PARSE_ERROR',\n      response.status,\n      `JSON ÌååÏã± Ïã§Ìå®: ${text.substring(0, 100)}`\n    );\n  }\n}\n\ninterface SMSResponse {\n  success: boolean;\n  messageId?: string;\n  error?: string;\n}\n\nexport const realSMSService = {\n  async sendConfirmation(reservation: Reservation) {\n    const message = `[PuppyHotel] ${reservation.owner_name}ÎãòÏùò ${reservation.pet_name} ${\n      reservation.service === 'grooming'\n        ? 'ÎØ∏Ïö©'\n        : reservation.service === 'hotel'\n        ? 'Ìò∏ÌÖî'\n        : 'Îç∞Ïù¥ÏºÄÏñ¥'\n    } ÏòàÏïΩÏù¥ ÌôïÏ†ïÎêòÏóàÏäµÎãàÎã§. ÏùºÏãú: ${reservation.reservation_date} ${\n      reservation.reservation_time || ''\n    }.`;\n\n    console.log('========================================');\n    console.log('üì± SMS Î∞úÏÜ° ÏãúÏûë');\n    console.log('========================================');\n    console.log('ÏàòÏã†Ïûê:', reservation.phone);\n    console.log('Î©îÏãúÏßÄ:', message);\n    console.log('API URL:', API_URL);\n    console.log('========================================');\n\n    try {\n      const phoneNumber = reservation.phone?.replace(/[^0-9]/g, '');\n\n      if (!phoneNumber) {\n        throw new SMSError(\n          'INVALID_PHONE',\n          undefined,\n          'Ïú†Ìö®Ìïú Ï†ÑÌôîÎ≤àÌò∏Í∞Ä ÏóÜÏäµÎãàÎã§'\n        );\n      }\n\n      const payload = {\n        to: phoneNumber,\n        message,\n        text: message,\n        reservationId: reservation.id,\n        customerName: reservation.owner_name,\n      };\n\n      console.log('üöÄ API Ìò∏Ï∂ú ÏãúÏûë');\n\n      const response = await fetchWithRetry(API_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json',\n        },\n        body: JSON.stringify(payload),\n        retries: 3,\n        timeout: 15000,\n      });\n\n      console.log('üì• ÏùëÎãµ ÏÉÅÌÉú:', response.status);\n\n      const data = await parseResponse<SMSResponse>(response);\n\n      console.log('========================================');\n      console.log('‚úÖ SMS Î∞úÏÜ° ÏÑ±Í≥µ!');\n      console.log('üìß Î©îÏãúÏßÄ ID:', data.messageId || 'N/A');\n      console.log('========================================');\n\n      return {\n        success: true,\n        message: 'SMS Î∞úÏÜ° ÏôÑÎ£å',\n        data,\n      };\n    } catch (error) {\n      console.log('========================================');\n      console.log('‚ùå SMS Î∞úÏÜ° Ïã§Ìå®');\n\n      if (error instanceof SMSError) {\n        console.error(`ÏóêÎü¨ ÏΩîÎìú: ${error.code}`);\n        console.error(`ÏÉÅÌÉú ÏΩîÎìú: ${error.statusCode || 'N/A'}`);\n        console.error(`Î©îÏãúÏßÄ: ${error.message}`);\n      } else {\n        console.error('ÏóêÎü¨:', error);\n      }\n\n      console.log('========================================');\n\n      return {\n        success: false,\n        error:\n          error instanceof SMSError\n            ? error.message\n            : error instanceof Error\n            ? error.message\n            : 'SMS Î∞úÏÜ° Ïã§Ìå®',\n        message: 'ÏòàÏïΩÏùÄ ÌôïÏ†ïÎêòÏóàÏúºÎÇò SMS Î∞úÏÜ°Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.',\n      };\n    }\n  },\n};\n\nexport { SMSError };","// ÎåÄÏãúÎ≥¥Îìú Supabase Ïó∞Îèô Ìó¨Ìçº ÌååÏùº (Ïª§Ïä§ÌÖÄ Î≤ÑÏ†Ñ)\nimport { reservationService } from './supabase';\nimport { realSMSService } from './realSMS';\nimport type { Reservation } from './supabase';\n// Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏Î•º ÏúÑÌï¥ Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî Ïú†Ìã∏Î¶¨Ìã∞ Í∞ÄÏ†∏Ïò§Í∏∞\nimport {\n  updateReservationData,\n  removeReservationData,\n} from '../components/feature/RealtimeReservationSync';\n\n// Supabase ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞Î•º ÎåÄÏãúÎ≥¥Îìú ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò\nexport function convertToLegacyFormat(reservation: Reservation) {\n  return {\n    id: reservation.id,\n    petName: reservation.pet_name,\n    ownerName: reservation.owner_name,\n    service: reservation.service,\n    date: reservation.reservation_date,\n    time: reservation.reservation_time || 'ÎØ∏Ï†ï',\n    status: reservation.status,\n    phone: reservation.phone,\n    roomType: reservation.room_type,\n    checkIn: reservation.check_in,\n    checkOut: reservation.check_out,\n    style: reservation.grooming_style,\n  };\n}\n\n// ÎåÄÏãúÎ≥¥Îìú ÌòïÏãùÏùÑ Supabase ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò\nexport function convertToSupabaseFormat(reservation: any) {\n  return {\n    pet_name: reservation.petName,\n    owner_name: reservation.ownerName,\n    service: reservation.service,\n    reservation_date: reservation.date || reservation.checkIn,\n    reservation_time: reservation.time,\n    status: reservation.status,\n    phone: reservation.phone,\n    room_type: reservation.roomType,\n    check_in: reservation.checkIn,\n    check_out: reservation.checkOut,\n    grooming_style: reservation.style,\n  };\n}\n\n// Ïã§ÏãúÍ∞Ñ ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞\nexport async function loadAllReservations() {\n  try {\n    const data = await reservationService.getAll();\n    // Convert to legacy format and filter out soft-deleted (cancelled) reservations.\n    return data\n      .map(convertToLegacyFormat)\n      .filter((r) => r.status !== 'cancelled' && r.status !== 'deleted');\n  } catch (error) {\n    console.error('ÏòàÏïΩ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);\n    return [];\n  }\n}\n\n// Soft delete reservations by updating status to 'cancelled'.\n// Returns an object with success flag and list of updated reservations (legacy format).\nexport async function softDeleteReservations(ids: string[]) {\n  if (!ids || ids.length === 0) {\n    return { success: false, error: 'No reservation IDs provided' };\n  }\n  try {\n    // Perform status update on each reservation. Do not send SMS when soft deleting.\n    const results = await Promise.all(\n      ids.map(async (id) => {\n        const res = await updateReservationStatus(id, 'cancelled', false);\n        return res;\n      }),\n    );\n    // Extract updated data where success is true\n    const updated = results\n      .filter((r) => r.success)\n      .map((r) => r.data);\n    return { success: true, data: updated };\n  } catch (error) {\n    console.error('ÏÜåÌîÑÌä∏ ÏÇ≠Ï†ú Ïã§Ìå®:', error);\n    return { success: false, error };\n  }\n}\n\n// ÏòàÏïΩ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ + SMS ÏûêÎèô Î∞úÏÜ°\nexport async function updateReservationStatus(\n  reservationId: string,\n  newStatus: string,\n  sendSMS: boolean = true,\n) {\n  try {\n    const updated = await reservationService.update(reservationId, {\n      status: newStatus as any,\n    });\n\n    // pending -> confirmed Î≥ÄÍ≤Ω Ïãú SMS Î∞úÏÜ°\n    if (sendSMS && newStatus === 'confirmed') {\n      try {\n        const smsResult = await realSMSService.sendConfirmation(updated);\n        if (smsResult.success) {\n          console.log('‚úÖ SMS Î∞úÏÜ° ÏÑ±Í≥µ');\n        } else {\n          console.warn('‚ö†Ô∏è SMS Î∞úÏÜ° Ïã§Ìå®:', smsResult.error);\n        }\n      } catch (error) {\n        console.warn('‚ö†Ô∏è SMS Î∞úÏÜ° Ïã§Ìå® (Î¨¥ÏãúÌïòÍ≥† Í≥ÑÏÜç):', error);\n      }\n    }\n\n    return { success: true, data: convertToLegacyFormat(updated) };\n  } catch (error) {\n    console.error('ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', error);\n    return { success: false, error };\n  }\n}\n\n// Ïã§ÏãúÍ∞Ñ Íµ¨ÎèÖ ÏÑ§Ï†ï\n// SupabaseÏóêÏÑú ÏÉàÎ°úÏö¥ ÏòàÏïΩ/ÏàòÏ†ï/ÏÇ≠Ï†ú Ïù¥Î≤§Ìä∏Î•º Í∞êÏßÄÌïòÏó¨ ÏΩúÎ∞±ÏùÑ Ìò∏Ï∂úÌïòÍ≥†\n// Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÎèÑ Î≥ÄÍ≤Ω ÏÇ¨Ìï≠ÏùÑ Î∞òÏòÅÌïúÎã§.\nexport function subscribeToReservations(callback: (data: any) => void) {\n  return reservationService.subscribeToChanges((payload: any) => {\n    console.log('ÏòàÏïΩ Î≥ÄÍ≤Ω Í∞êÏßÄ:', payload);\n    // INSERT, UPDATE, DELETE Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨\n    if (payload.eventType === 'INSERT' || payload.eventType === 'UPDATE') {\n      const legacy = convertToLegacyFormat(payload.new as Reservation);\n      // Always notify callback\n      callback({ type: payload.eventType, data: legacy });\n      try {\n        // For soft-deleted reservations (status cancelled or deleted), remove from localStorage and skip re-adding.\n        if (legacy.status === 'cancelled' || legacy.status === 'deleted') {\n          removeReservationData([legacy.id]);\n        } else {\n          // Remove any existing entry to avoid duplicates\n          removeReservationData([legacy.id]);\n          updateReservationData(legacy, legacy.service as any);\n        }\n      } catch (e) {\n        console.warn('localStorage ÏòàÏïΩ ÎèôÍ∏∞Ìôî Ïã§Ìå®:', e);\n      }\n    } else if (payload.eventType === 'DELETE') {\n      const id = payload.old.id;\n      callback({ type: 'DELETE', id });\n      try {\n        removeReservationData([id]);\n      } catch (e) {\n        console.warn('localStorage ÏòàÏïΩ ÏÇ≠Ï†ú ÎèôÍ∏∞Ìôî Ïã§Ìå®:', e);\n      }\n    }\n  });\n}"],"names":["RealtimeReservationSync","useEffect","handleStorageChange","e","updateReservationData","newReservation","type","allReservations","allIndex","serviceKey","serviceReservations","serviceIndex","removeReservationData","ids","filteredAll","r","key","filtered","DEFAULT_ENDPOINT","hasCustomEndpoint","shouldUseCustomEndpoint","windowOrigin","sameOriginEndpoint","API_URL","SMSError","code","statusCode","message","sleep","ms","resolve","fetchWithRetry","url","options","retries","timeout","fetchOptions","lastError","attempt","controller","timeoutId","response","delay","error","parseResponse","contentType","text","realSMSService","reservation","phoneNumber","payload","data","convertToLegacyFormat","loadAllReservations","reservationService","updateReservationStatus","reservationId","newStatus","sendSMS","updated","smsResult","subscribeToReservations","callback","legacy","id"],"mappings":"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"}