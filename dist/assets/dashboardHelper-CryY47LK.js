import{r as u}from"./supabase-DzxmIhwm.js";import{r as R}from"./index-CXV8rOrb.js";function P(){return R.useEffect(()=>{(()=>{localStorage.getItem("allReservations")||localStorage.setItem("allReservations",JSON.stringify([])),localStorage.getItem("hotelReservations")||localStorage.setItem("hotelReservations",JSON.stringify([])),localStorage.getItem("groomingReservations")||localStorage.setItem("groomingReservations",JSON.stringify([])),localStorage.getItem("daycareReservations")||localStorage.setItem("daycareReservations",JSON.stringify([]))})();const o=t=>{(t.key==="allReservations"||t.key==="hotelReservations"||t.key==="groomingReservations"||t.key==="daycareReservations")&&window.dispatchEvent(new CustomEvent("reservationUpdated"))};return window.addEventListener("storage",o),()=>{window.removeEventListener("storage",o)}},[]),null}const w=(e,o)=>{const t=JSON.parse(localStorage.getItem("allReservations")||"[]"),n=t.findIndex(r=>r.id===e.id);n!==-1?t[n]=e:t.push(e),localStorage.setItem("allReservations",JSON.stringify(t));let s;switch(o){case"hotel":s="hotelReservations";break;case"grooming":s="groomingReservations";break;case"daycare":s="daycareReservations";break;default:s="groomingReservations"}const c=JSON.parse(localStorage.getItem(s)||"[]"),a=c.findIndex(r=>r.id===e.id);a!==-1?c[a]=e:c.push(e),localStorage.setItem(s,JSON.stringify(c)),window.dispatchEvent(new CustomEvent("reservationUpdated")),console.log(`âœ… ì˜ˆì•½ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${o} - ${e.petName} (${e.id})`)},d=e=>{if(!e?.length)return;const t=JSON.parse(localStorage.getItem("allReservations")||"[]").filter(s=>!e.includes(s.id));localStorage.setItem("allReservations",JSON.stringify(t)),["hotelReservations","groomingReservations","daycareReservations"].forEach(s=>{const a=JSON.parse(localStorage.getItem(s)||"[]").filter(r=>!e.includes(r.id));localStorage.setItem(s,JSON.stringify(a))}),window.dispatchEvent(new CustomEvent("reservationUpdated"))},S="/api/sms/confirm",v=!0,E=v&&!0,p=typeof window<"u"?window.location.origin:"",N=p?`${p}${S}`:S,h=E?"https://ì˜ˆì•½ë´‡.kr/api/sms/confirm":N;class i extends Error{constructor(o,t,n){super(n||`SMS Error: ${o}`),this.code=o,this.statusCode=t,this.name="SMSError"}}async function y(e){return new Promise(o=>setTimeout(o,e))}async function I(e,o={}){const{retries:t=3,timeout:n=15e3,...s}=o;let c=null;for(let a=1;a<=t;a++)try{const r=new AbortController,g=setTimeout(()=>r.abort(),n),l=await fetch(e,{...s,signal:r.signal});if(clearTimeout(g),l.ok)return l;if((l.status>=500||l.status===429)&&a<t){const f=1e3*a;console.warn(`âš ï¸  ì¬ì‹œë„ ${a}/${t} (${f}ms í›„): HTTP ${l.status}`),await y(f);continue}throw new i("HTTP_ERROR",l.status,`HTTP ${l.status}: ${l.statusText}`)}catch(r){if(c=r,r instanceof i)throw r;if(r instanceof TypeError&&r.message.includes("fetch")&&a<t){const g=1e3*a;console.warn(`âš ï¸  ì¬ì‹œë„ ${a}/${t} (${g}ms í›„): ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜`),await y(g);continue}throw new i("NETWORK_ERROR",void 0,`ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${c.message}`)}throw c||new i("UNKNOWN_ERROR",void 0,"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜")}async function T(e){const o=e.headers.get("content-type"),t=await e.text();if(!t)throw new i("EMPTY_RESPONSE",e.status,"API ì‘ë‹µì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤");if(!o?.includes("application/json"))throw new i("INVALID_CONTENT_TYPE",e.status,`ì˜ˆìƒì¹˜ ëª»í•œ Content-Type: ${o}`);try{return JSON.parse(t)}catch{throw new i("JSON_PARSE_ERROR",e.status,`JSON íŒŒì‹± ì‹¤íŒ¨: ${t.substring(0,100)}`)}}const O={async sendConfirmation(e){const o=`[PuppyHotel] ${e.owner_name}ë‹˜ì˜ ${e.pet_name} ${e.service==="grooming"?"ë¯¸ìš©":e.service==="hotel"?"í˜¸í…”":"ë°ì´ì¼€ì–´"} ì˜ˆì•½ì´ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ì¼ì‹œ: ${e.reservation_date} ${e.reservation_time||""}.`;console.log("========================================"),console.log("ğŸ“± SMS ë°œì†¡ ì‹œì‘"),console.log("========================================"),console.log("ìˆ˜ì‹ ì:",e.phone),console.log("ë©”ì‹œì§€:",o),console.log("API URL:",h),console.log("========================================");try{const t=e.phone?.replace(/[^0-9]/g,"");if(!t)throw new i("INVALID_PHONE",void 0,"ìœ íš¨í•œ ì „í™”ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤");const n={to:t,message:o,text:o,reservationId:e.id,customerName:e.owner_name};console.log("ğŸš€ API í˜¸ì¶œ ì‹œì‘");const s=await I(h,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(n),retries:3,timeout:15e3});console.log("ğŸ“¥ ì‘ë‹µ ìƒíƒœ:",s.status);const c=await T(s);return console.log("========================================"),console.log("âœ… SMS ë°œì†¡ ì„±ê³µ!"),console.log("ğŸ“§ ë©”ì‹œì§€ ID:",c.messageId||"N/A"),console.log("========================================"),{success:!0,message:"SMS ë°œì†¡ ì™„ë£Œ",data:c}}catch(t){return console.log("========================================"),console.log("âŒ SMS ë°œì†¡ ì‹¤íŒ¨"),t instanceof i?(console.error(`ì—ëŸ¬ ì½”ë“œ: ${t.code}`),console.error(`ìƒíƒœ ì½”ë“œ: ${t.statusCode||"N/A"}`),console.error(`ë©”ì‹œì§€: ${t.message}`)):console.error("ì—ëŸ¬:",t),console.log("========================================"),{success:!1,error:t instanceof i||t instanceof Error?t.message:"SMS ë°œì†¡ ì‹¤íŒ¨",message:"ì˜ˆì•½ì€ í™•ì •ë˜ì—ˆìœ¼ë‚˜ SMS ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."}}}};function m(e){return{id:e.id,petName:e.pet_name,ownerName:e.owner_name,service:e.service,date:e.reservation_date,time:e.reservation_time||"ë¯¸ì •",status:e.status,phone:e.phone,roomType:e.room_type,checkIn:e.check_in,checkOut:e.check_out,style:e.grooming_style}}async function A(){try{return(await u.getAll()).map(m).filter(o=>o.status!=="cancelled"&&o.status!=="deleted")}catch(e){return console.error("ì˜ˆì•½ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",e),[]}}async function J(e,o,t=!0){try{const n=await u.update(e,{status:o});if(t&&o==="confirmed")try{const s=await O.sendConfirmation(n);s.success?console.log("âœ… SMS ë°œì†¡ ì„±ê³µ"):console.warn("âš ï¸ SMS ë°œì†¡ ì‹¤íŒ¨:",s.error)}catch(s){console.warn("âš ï¸ SMS ë°œì†¡ ì‹¤íŒ¨ (ë¬´ì‹œí•˜ê³  ê³„ì†):",s)}return{success:!0,data:m(n)}}catch(n){return console.error("ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",n),{success:!1,error:n}}}function C(e){return u.subscribeToChanges(o=>{if(console.log("ì˜ˆì•½ ë³€ê²½ ê°ì§€:",o),o.eventType==="INSERT"||o.eventType==="UPDATE"){const t=m(o.new);e({type:o.eventType,data:t});try{t.status==="cancelled"||t.status==="deleted"?d([t.id]):(d([t.id]),w(t,t.service))}catch(n){console.warn("localStorage ì˜ˆì•½ ë™ê¸°í™” ì‹¤íŒ¨:",n)}}else if(o.eventType==="DELETE"){const t=o.old.id;e({type:"DELETE",id:t});try{d([t])}catch(n){console.warn("localStorage ì˜ˆì•½ ì‚­ì œ ë™ê¸°í™” ì‹¤íŒ¨:",n)}}})}export{P as R,J as a,m as c,A as l,d as r,C as s,w as u};
//# sourceMappingURL=dashboardHelper-CryY47LK.js.map
