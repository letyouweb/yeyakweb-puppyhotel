{"version":3,"file":"adminReservationActions-BcfFZl9V.js","sources":["../../src/lib/adminReservationActions.ts"],"sourcesContent":["import {\n  updateReservationData,\n  removeReservationData,\n} from '../components/feature/RealtimeReservationSync';\nimport { updateReservationStatus } from './dashboardHelper';\nimport { reservationService } from './supabase';\nimport { convertToLegacyFormat } from './dashboardHelper';\n\ntype LegacyReservation = ReturnType<typeof convertToLegacyFormat>;\nexport type ReservationStatus = 'confirmed' | 'pending' | 'completed' | 'cancelled';\n\nconst dispatchReservationUpdated = () => {\n  if (typeof window !== 'undefined') {\n    window.dispatchEvent(new CustomEvent('reservationUpdated'));\n  }\n};\n\nconst syncReservationCache = (reservationId: string, reservation?: LegacyReservation) => {\n  try {\n    removeReservationData([reservationId]);\n  } catch (error) {\n    console.warn('localStorage reservation removal failed:', error);\n  }\n\n  if (reservation && reservation.status !== 'cancelled' && reservation.status !== 'deleted') {\n    try {\n      updateReservationData(reservation, reservation.service as any);\n    } catch (error) {\n      console.warn('localStorage reservation update failed:', error);\n    }\n  }\n};\n\nexport async function changeReservationStatus(\n  reservationId: string,\n  newStatus: ReservationStatus,\n) {\n  try {\n    const result = await updateReservationStatus(\n      reservationId,\n      newStatus,\n      newStatus === 'confirmed',\n    );\n    if (!result.success || !result.data) {\n      return { success: false, error: result.error };\n    }\n    const updatedReservation = result.data;\n    syncReservationCache(reservationId, updatedReservation);\n    dispatchReservationUpdated();\n    return { success: true, reservation: updatedReservation };\n  } catch (error) {\n    return { success: false, error };\n  }\n}\n\nexport async function confirmReservation(reservationId: string) {\n  return changeReservationStatus(reservationId, 'confirmed');\n}\n\nexport async function completeReservation(reservationId: string) {\n  return changeReservationStatus(reservationId, 'completed');\n}\n\nexport async function cancelReservation(reservationId: string) {\n  return changeReservationStatus(reservationId, 'cancelled');\n}\n\nexport async function deleteReservation(reservationId: string) {\n  try {\n    await reservationService.remove(reservationId);\n    syncReservationCache(reservationId);\n    dispatchReservationUpdated();\n    return { success: true };\n  } catch (error) {\n    return { success: false, error };\n  }\n}\n"],"names":["dispatchReservationUpdated","syncReservationCache","reservationId","reservation","removeReservationData","error","updateReservationData","changeReservationStatus","newStatus","result","updateReservationStatus","updatedReservation","confirmReservation","deleteReservation","reservationService"],"mappings":"2GAWA,MAAMA,EAA6B,IAAM,CACnC,OAAO,OAAW,KACpB,OAAO,cAAc,IAAI,YAAY,oBAAoB,CAAC,CAE9D,EAEMC,EAAuB,CAACC,EAAuBC,IAAoC,CACvF,GAAI,CACFC,EAAsB,CAACF,CAAa,CAAC,CACvC,OAASG,EAAO,CACd,QAAQ,KAAK,2CAA4CA,CAAK,CAChE,CAEA,GAAIF,GAAeA,EAAY,SAAW,aAAeA,EAAY,SAAW,UAC9E,GAAI,CACFG,EAAsBH,EAAaA,EAAY,OAAc,CAC/D,OAASE,EAAO,CACd,QAAQ,KAAK,0CAA2CA,CAAK,CAC/D,CAEJ,EAEA,eAAsBE,EACpBL,EACAM,EACA,CACA,GAAI,CACF,MAAMC,EAAS,MAAMC,EACnBR,EACAM,EACAA,IAAc,WAAA,EAEhB,GAAI,CAACC,EAAO,SAAW,CAACA,EAAO,KAC7B,MAAO,CAAE,QAAS,GAAO,MAAOA,EAAO,KAAA,EAEzC,MAAME,EAAqBF,EAAO,KAClC,OAAAR,EAAqBC,EAAeS,CAAkB,EACtDX,EAAA,EACO,CAAE,QAAS,GAAM,YAAaW,CAAA,CACvC,OAASN,EAAO,CACd,MAAO,CAAE,QAAS,GAAO,MAAAA,CAAA,CAC3B,CACF,CAEA,eAAsBO,EAAmBV,EAAuB,CAC9D,OAAOK,EAAwBL,EAAe,WAAW,CAC3D,CAUA,eAAsBW,EAAkBX,EAAuB,CAC7D,GAAI,CACF,aAAMY,EAAmB,OAAOZ,CAAa,EAC7CD,EAAqBC,CAAa,EAClCF,EAAA,EACO,CAAE,QAAS,EAAA,CACpB,OAASK,EAAO,CACd,MAAO,CAAE,QAAS,GAAO,MAAAA,CAAA,CAC3B,CACF"}